<div class="threejs-visualization-container" [class.loading]="isLoading">
  <!-- Three.js Canvas Container -->
  <div #threeContainer
       class="threejs-canvas-container"
       [class.drag-mode]="dragModeEnabled"
       (contextmenu)="$event.preventDefault()">
  </div>

  <!-- Loading Overlay -->
  <div class="loading-overlay" *ngIf="isLoading">
    <div class="loading-spinner">
      <div class="spinner"></div>
      <p>ğŸ® 3D GÃ¶rselleÅŸtirme HazÄ±rlanÄ±yor...</p>
    </div>
  </div>

  <!-- No Data Message -->
  <div class="no-data-message" *ngIf="!isLoading && (!piecesData || piecesData.length === 0)">
    <div class="no-data-content">
      <div class="empty-icon">ğŸš›</div>
      <h4>HenÃ¼z YÃ¼kleme Verisi Yok</h4>
      <p>TÄ±r yÃ¼kleme algoritmasÄ± Ã§alÄ±ÅŸtÄ±rÄ±ldÄ±ktan sonra 3D gÃ¶rselleÅŸtirme burada gÃ¶rÃ¼necek.</p>
    </div>
  </div>

  <!-- Enhanced Three.js Controls Overlay -->
  <div class="threejs-controls-overlay" *ngIf="showControls && !isLoading && piecesData && piecesData.length > 0">
    <div class="controls-panel">
      <h4>ğŸ® 3D Kontroller</h4>

      <!-- Movement Controls -->
      <div class="control-section">
        <h5>ğŸ–±ï¸ Hareket</h5>
        <div class="control-buttons">
          <button class="control-btn" [class.active]="dragModeEnabled" (click)="toggleDragMode()">
            {{ dragModeEnabled ? 'ğŸ¤' : 'ğŸ–±ï¸' }} {{ dragModeEnabled ? 'SÃ¼rÃ¼kle: AÃ‡IK' : 'SÃ¼rÃ¼kle: KAPALI' }}
          </button>
        </div>
      </div>

      <!-- View Controls -->
      <div class="control-section">
        <h5>ğŸ‘ï¸ GÃ¶rÃ¼nÃ¼m</h5>
        <div class="control-buttons">
          <button class="control-btn" [class.active]="wireframeMode" (click)="toggleWireframe()">
            ğŸ”³ Wireframe
          </button>
          <button class="control-btn" (click)="resetView()">
            ğŸ¯ Reset View
          </button>
          <button class="control-btn" (click)="toggleFullscreen()">
            â›¶ Fullscreen
          </button>
        </div>
      </div>

      <!-- Camera Presets -->
      <div class="view-buttons">
        <button class="view-btn" [class.active]="currentView === 'front'" (click)="setView('front')">Ã–n</button>
        <button class="view-btn" [class.active]="currentView === 'side'" (click)="setView('side')">Yan</button>
        <button class="view-btn" [class.active]="currentView === 'top'" (click)="setView('top')">Ãœst</button>
        <button class="view-btn" [class.active]="currentView === 'isometric'" (click)="setView('isometric')">3D</button>
      </div>

      <!-- Enhanced Drag Instructions -->
      <div class="drag-instructions" *ngIf="dragModeEnabled">
        <div class="instruction-text">
          ğŸ¯ <strong>SÃ¼rÃ¼kleme Modu Aktif</strong><br>
          <small>âš¡ Paketleri tÄ±klayÄ±p sÃ¼rÃ¼kleyerek hareket ettirin</small><br>
          <small>ğŸ”„ SeÃ§ili paketi dÃ¶ndÃ¼rmek iÃ§in "DÃ¶ndÃ¼r" butonunu kullanÄ±n</small><br>
          <small>ğŸ—‘ï¸ Paketleri silmek iÃ§in seÃ§ip "Sil" butonunu kullanÄ±n</small>
        </div>
      </div>
    </div>
  </div>

  <!-- Enhanced Package Info Panel -->
  <div class="package-info-panel" *ngIf="selectedPackage && !isLoading">
    <div class="info-content">
      <h4>ğŸ“¦ SeÃ§ili Paket</h4>
      <div class="package-details">
        <div class="detail-row">
          <span class="label">ID:</span>
          <span class="value">{{ selectedPackage.id }}</span>
        </div>
        <div class="detail-row">
          <span class="label">Boyutlar:</span>
          <span class="value">{{ selectedPackage.dimensions }}</span>
        </div>
        <div class="detail-row">
          <span class="label">AÄŸÄ±rlÄ±k:</span>
          <span class="value">{{ selectedPackage.weight }} kg</span>
        </div>
        <div class="detail-row">
          <span class="label">Pozisyon:</span>
          <span class="value">({{ selectedPackage.x | number:'1.0-0' }}, {{ selectedPackage.y | number:'1.0-0' }}, {{ selectedPackage.z | number:'1.0-0' }})</span>
        </div>
      </div>

      <!-- Enhanced Package Actions -->
      <div class="package-actions">
        <button class="action-btn rotate-btn" (click)="rotateSelectedPackage()" title="90Â° DÃ¶ndÃ¼r">
          ğŸ”„ DÃ¶ndÃ¼r
        </button>
        <button class="action-btn delete-btn" (click)="deleteSelectedPackage()" title="Paketi Sil">
          ğŸ—‘ï¸ Sil
        </button>
        <button class="action-btn move-btn"
                [disabled]="!dragModeEnabled"
                (click)="dragModeEnabled ? null : toggleDragMode()"
                title="SÃ¼rÃ¼kleme Modunu AktifleÅŸtir">
          ğŸ¯ TaÅŸÄ±
        </button>
      </div>

      <button class="close-btn" (click)="clearSelection()" title="Kapat">âœ–</button>
    </div>
  </div>

  <!-- Enhanced Deleted Packages Panel -->
  <div class="deleted-packages-panel"
       *ngIf="deletedPackages.length > 0 && !isLoading"
       [class.below-selection]="selectedPackage">
    <div class="deleted-content">
      <h4>
        ğŸ—‘ï¸ Silinen Paketler
        <span class="delete-count">{{ deletedPackages.length }}</span>
      </h4>
      <div class="deleted-list">
        <div class="deleted-item" *ngFor="let pkg of deletedPackages; trackBy: trackDeletedPackage">
          <div class="deleted-info">
            <span class="deleted-id">#{{ pkg.id }}</span>
            <span class="deleted-dims">{{ pkg.dimensions }}</span>
            <span class="deleted-weight">{{ pkg.weight }}kg</span>
          </div>
          <button class="restore-btn" (click)="restorePackage(pkg)" title="Paketi Geri Ekle">
            â• Ekle
          </button>
        </div>
      </div>

      <!-- Bulk Actions -->
      <div class="bulk-actions" *ngIf="deletedPackages.length > 1">
        <button class="bulk-btn restore-all-btn" (click)="restoreAllPackages()">
          â™»ï¸ Hepsini Geri Al
        </button>
        <button class="bulk-btn clear-all-btn" (click)="clearAllDeleted()">
          ğŸ—‘ï¸ Hepsini Temizle
        </button>
      </div>
    </div>
  </div>

  <!-- Enhanced Stats Overlay -->
  <div class="stats-overlay" *ngIf="showStats && !isLoading && piecesData && piecesData.length > 0">
    <div class="stats-content">
      <div class="stat-item">
        <span class="stat-label">ğŸ“¦ Paketler</span>
        <span class="stat-value">{{ processedPackages.length }}/{{ originalPackageCount }}</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">âš¡ FPS</span>
        <span class="stat-value" [class]="getFPSClass()">{{ currentFPS }}</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">ğŸ” Zoom</span>
        <span class="stat-value">{{ zoomLevel }}%</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">ğŸ—‘ï¸ Silinen</span>
        <span class="stat-value">{{ deletedPackages.length }}</span>
      </div>
    </div>
  </div>

  <!-- Enhanced Zoom Controls -->
  <div class="zoom-controls" *ngIf="!isLoading && piecesData && piecesData.length > 0">
    <button class="zoom-btn" (click)="zoomOut()" title="UzaklaÅŸtÄ±r">ğŸ”-</button>
    <div class="zoom-slider-container">
      <input type="range"
             class="zoom-slider"
             [min]="minZoom"
             [max]="maxZoom"
             [ngModel]="zoomLevel"
             (input)="setZoomLevelFromInput($event)"
             title="Zoom: {{ zoomLevel }}%">
    </div>
    <button class="zoom-btn" (click)="zoomIn()" title="YakÄ±nlaÅŸtÄ±r">ğŸ”+</button>
  </div>

  <!-- Enhanced Collision Warning -->
  <div class="collision-warning" *ngIf="showCollisionWarning">
    <div class="warning-content">
      <span class="warning-icon">âš ï¸</span>
      <span class="warning-text">Ã‡arpÄ±ÅŸma! Paket bu pozisyona yerleÅŸtirilemez.</span>
    </div>
  </div>
</div>
