<!-- Main Container -->
    <div class="truck-visualization-container" [class.fullscreen-mode]="isFullscreen">

      <!-- Header Controls -->
      <div class="header-controls" *ngIf="!isFullscreen">
        <div class="title-section">
          <h3 class="visualization-title">
            <i class="icon-truck"></i>
            Three.js TÄ±r YÃ¼kleme GÃ¶rselleÅŸtirmesi
          </h3>
          <div class="stats-badges">
            <span class="stat-badge success" *ngIf="loadingStats.packagesLoaded">
              <i class="icon-package"></i>
              {{loadingStats.packagesLoaded}}/{{loadingStats.totalPackages}} Paket
            </span>
            <span class="stat-badge info" *ngIf="loadingStats.utilizationRate">
              <i class="icon-percent"></i>
              %{{loadingStats.utilizationRate}} Doluluk
            </span>
            <span class="stat-badge warning" *ngIf="loadingStats.cogScore">
              <i class="icon-balance"></i>
              COG: {{loadingStats.cogScore}}/100
            </span>
          </div>
        </div>

        <div class="control-buttons">
          <button class="control-btn secondary" (click)="resetView()" title="GÃ¶rÃ¼nÃ¼mÃ¼ SÄ±fÄ±rla">
            <i class="icon-reset"></i>
            <span class="btn-text">SÄ±fÄ±rla</span>
          </button>
          <button class="control-btn secondary" (click)="toggleWireframe()" title="Wireframe Modunu AÃ§/Kapat">
            <i class="icon-wireframe"></i>
            <span class="btn-text">{{wireframeMode ? 'Solid' : 'Wireframe'}}</span>
          </button>
          <button class="control-btn secondary" (click)="toggleDragMode()"
                  [class.active]="dragModeEnabled" title="Drag & Drop Modunu AÃ§/Kapat">
            <i class="icon-drag"></i>
            <span class="btn-text">{{dragModeEnabled ? 'Drag: ON' : 'Drag: OFF'}}</span>
          </button>
          <button class="control-btn primary" (click)="toggleFullscreen()" title="Tam Ekran">
            <i class="icon-fullscreen" [class.icon-exit-fullscreen]="isFullscreen"></i>
            <span class="btn-text">{{isFullscreen ? 'Ã‡Ä±k' : 'Tam Ekran'}}</span>
          </button>
        </div>
      </div>

      <!-- Main Visualization Area -->
      <div class="visualization-wrapper">

        <!-- Three.js Container -->
        <div #threeContainer class="threejs-container"
             [class.loading]="isLoading"
             [class.fullscreen]="isFullscreen"
             [class.drag-mode]="dragModeEnabled">

          <!-- Loading Spinner -->
          <div class="loading-overlay" *ngIf="isLoading">
            <div class="loading-spinner">
              <div class="spinner"></div>
              <p>3D GÃ¶rselleÅŸtirme HazÄ±rlanÄ±yor...</p>
            </div>
          </div>

          <!-- No Data Message -->
          <div class="no-data-message" *ngIf="!isLoading && (!piecesData || piecesData.length === 0)">
            <div class="no-data-content">
              <i class="icon-empty-truck"></i>
              <h4>HenÃ¼z YÃ¼kleme Verisi Yok</h4>
              <p>TÄ±r yÃ¼kleme algoritmasÄ± Ã§alÄ±ÅŸtÄ±rÄ±ldÄ±ktan sonra 3D gÃ¶rselleÅŸtirme burada gÃ¶rÃ¼necek.</p>
            </div>
          </div>

          <!-- Drag Instructions -->
          <div class="drag-instructions" *ngIf="dragModeEnabled && hasResults">
            <div class="instruction-content">
              <h4>ğŸ–±ï¸ Drag & Drop Modu Aktif</h4>
              <div class="instruction-list">
                <div class="instruction-item">
                  <kbd>Sol TÄ±k + SÃ¼rÃ¼kle</kbd>
                  <span>Paketi TaÅŸÄ±</span>
                </div>
                <div class="instruction-item">
                  <kbd>R tuÅŸu</kbd>
                  <span>Paketi DÃ¶ndÃ¼r</span>
                </div>
                <div class="instruction-item">
                  <kbd>Escape</kbd>
                  <span>SeÃ§imi Ä°ptal Et</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Side Information Panel -->
        <div class="info-panel" [class.collapsed]="infoPanelCollapsed" *ngIf="!isFullscreen && piecesData && piecesData.length > 0">

          <!-- Panel Header -->
          <div class="panel-header">
            <h4 class="panel-title">
              <i class="icon-info"></i>
              YÃ¼kleme Bilgileri
            </h4>
            <button class="panel-toggle" (click)="toggleInfoPanel()">
              <i class="icon-chevron" [class.rotated]="infoPanelCollapsed"></i>
            </button>
          </div>

          <!-- Panel Content -->
          <div class="panel-content" *ngIf="!infoPanelCollapsed">

            <!-- Truck Dimensions -->
            <div class="info-section">
              <h5 class="section-title">
                <i class="icon-dimensions"></i>
                TÄ±r BoyutlarÄ±
              </h5>
              <div class="dimensions-grid">
                <div class="dimension-item">
                  <span class="dimension-label">Uzunluk</span>
                  <span class="dimension-value">{{truckDimension[0]}} mm</span>
                </div>
                <div class="dimension-item">
                  <span class="dimension-label">GeniÅŸlik</span>
                  <span class="dimension-value">{{truckDimension[1]}} mm</span>
                </div>
                <div class="dimension-item">
                  <span class="dimension-label">YÃ¼kseklik</span>
                  <span class="dimension-value">{{truckDimension[2]}} mm</span>
                </div>
              </div>
            </div>

            <!-- Loading Statistics -->
            <div class="info-section">
              <h5 class="section-title">
                <i class="icon-statistics"></i>
                YÃ¼kleme Ä°statistikleri
              </h5>
              <div class="stats-list">
                <div class="stat-item">
                  <span class="stat-label">Toplam Paket</span>
                  <span class="stat-value">{{loadingStats.totalPackages}}</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">YÃ¼klenen Paket</span>
                  <span class="stat-value success">{{loadingStats.packagesLoaded}}</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Hacim KullanÄ±mÄ±</span>
                  <span class="stat-value info">%{{loadingStats.utilizationRate}}</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">AÄŸÄ±rlÄ±k Merkezi</span>
                  <span class="stat-value" [class]="getCogScoreClass()">{{loadingStats.cogScore}}/100</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Toplam AÄŸÄ±rlÄ±k</span>
                  <span class="stat-value">{{loadingStats.totalWeight}} kg</span>
                </div>
              </div>
            </div>

            <!-- Package List -->
            <div class="info-section">
              <h5 class="section-title">
                <i class="icon-list"></i>
                Paket Listesi
                <span class="package-count">({{getDisplayedPackages().length}})</span>
              </h5>
              <div class="package-list">
                <div class="package-item"
                     *ngFor="let package of getDisplayedPackages(); let i = index; trackBy: trackByPackage"
                     (click)="highlightPackage(package)"
                     [class.highlighted]="highlightedPackage?.id === package.id"
                     [class.dragging]="dragState.draggedPackage?.id === package.id">
                  <div class="package-color" [style.background-color]="package.color"></div>
                  <div class="package-info">
                    <span class="package-id">Palet {{package.id}}</span>
                    <span class="package-details">{{package.dimensions}} - {{package.weight}}kg</span>
                  </div>
                  <div class="package-position">
                    <span class="position-label">Pozisyon:</span>
                    <span class="position-value">({{package.x | number:'1.0-0'}}, {{package.y | number:'1.0-0'}}, {{package.z | number:'1.0-0'}})</span>
                  </div>
                </div>
              </div>

              <!-- Show More Button -->
              <button class="show-more-btn"
                      *ngIf="getDisplayedPackages().length < getTotalPackages()"
                      (click)="showMorePackages()">
                <i class="icon-more"></i>
                Daha Fazla GÃ¶ster ({{getTotalPackages() - getDisplayedPackages().length}} kaldÄ±)
              </button>
            </div>

            <!-- View Controls -->
            <div class="info-section">
              <h5 class="section-title">
                <i class="icon-view"></i>
                GÃ¶rÃ¼nÃ¼m Kontrolleri
              </h5>
              <div class="view-controls">
                <button class="view-btn" (click)="setView('front')" [class.active]="currentView === 'front'">
                  <i class="icon-view-front"></i>
                  Ã–n
                </button>
                <button class="view-btn" (click)="setView('side')" [class.active]="currentView === 'side'">
                  <i class="icon-view-side"></i>
                  Yan
                </button>
                <button class="view-btn" (click)="setView('top')" [class.active]="currentView === 'top'">
                  <i class="icon-view-top"></i>
                  Ãœst
                </button>
                <button class="view-btn" (click)="setView('isometric')" [class.active]="currentView === 'isometric'">
                  <i class="icon-view-iso"></i>
                  Ä°zometrik
                </button>
              </div>
            </div>

          </div>
        </div>
      </div>

      <!-- Fullscreen Controls -->
      <div class="fullscreen-controls" *ngIf="isFullscreen">
        <div class="fullscreen-header">
          <h3 class="fullscreen-title">
            <i class="icon-truck"></i>
            Three.js TÄ±r YÃ¼kleme GÃ¶rselleÅŸtirmesi
          </h3>
          <div class="fullscreen-stats">
            <span class="fs-stat">{{loadingStats.packagesLoaded}}/{{loadingStats.totalPackages}} Paket</span>
            <span class="fs-stat">%{{loadingStats.utilizationRate}} Doluluk</span>
            <span class="fs-stat">COG: {{loadingStats.cogScore}}/100</span>
            <span class="fs-stat" *ngIf="dragModeEnabled" style="color: #10b981;">ğŸ–±ï¸ Drag Mode</span>
          </div>
        </div>

        <div class="fullscreen-buttons">
          <button class="fs-btn" (click)="resetView()" title="GÃ¶rÃ¼nÃ¼mÃ¼ SÄ±fÄ±rla">
            <i class="icon-reset"></i>
          </button>
          <button class="fs-btn" (click)="toggleWireframe()" title="Wireframe">
            <i class="icon-wireframe"></i>
          </button>
          <button class="fs-btn" (click)="toggleDragMode()"
                  [class.active]="dragModeEnabled" title="Drag Mode">
            <i class="icon-drag"></i>
          </button>
          <button class="fs-btn primary" (click)="toggleFullscreen()" title="Tam Ekrandan Ã‡Ä±k">
            <i class="icon-exit-fullscreen"></i>
          </button>
        </div>
      </div>

      <!-- Quick Help -->
      <div class="quick-help" *ngIf="showHelp && !isFullscreen">
        <div class="help-content">
          <h4>Three.js Kontrolleri</h4>
          <div class="help-list">
            <div class="help-item" *ngIf="!dragModeEnabled">
              <kbd>Sol TÄ±k + SÃ¼rÃ¼kle</kbd>
              <span>DÃ¶ndÃ¼r</span>
            </div>
            <div class="help-item" *ngIf="dragModeEnabled">
              <kbd>Sol TÄ±k + SÃ¼rÃ¼kle</kbd>
              <span>Paketi TaÅŸÄ±</span>
            </div>
            <div class="help-item">
              <kbd>Tekerlek</kbd>
              <span>YakÄ±nlaÅŸtÄ±r/UzaklaÅŸtÄ±r</span>
            </div>
            <div class="help-item">
              <kbd>SaÄŸ TÄ±k + SÃ¼rÃ¼kle</kbd>
              <span>KaydÄ±r</span>
            </div>
            <div class="help-item" *ngIf="dragModeEnabled">
              <kbd>R</kbd>
              <span>Paketi DÃ¶ndÃ¼r</span>
            </div>
            <div class="help-item">
              <kbd>ESC</kbd>
              <span>Tam Ekrandan Ã‡Ä±k</span>
            </div>
          </div>
          <button class="close-help" (click)="closeHelp()">
            <i class="icon-close"></i>
          </button>
        </div>
      </div>
    </div>
