<div class="logistics-result-screen">
  <div class="result-header">
    <div class="header-icon">
      <mat-icon>view_in_ar</mat-icon>
    </div>
    <div class="header-title">
      <h1>TIR YÃ¼kleme Optimizasyonu</h1>
      <p class="header-subtitle">3 boyutlu yÃ¼kleme planÄ±</p>
    </div>
  </div>

  <!-- Enhanced Status Bar -->
  <div class="status-bar">
    <div class="status-item">
      <div class="status-icon">
        <mat-icon>inventory_2</mat-icon>
      </div>
      <div class="status-info">
        <span class="status-label">YÃ¼klenecek ÃœrÃ¼n</span>
        <span class="status-value"
          >{{ loadingStats.packagesLoaded || 0 }} /
          {{ loadingStats.totalPackages || 0 }} adet</span
        >
      </div>
    </div>

    <div class="status-item">
      <div class="status-icon truck-icon">
        <mat-icon>local_shipping</mat-icon>
      </div>
      <div class="status-info">
        <span class="status-label">TIR BoyutlarÄ±</span>
        <span class="status-value"
          >{{ truckDimension[0] || 0 }} x {{ truckDimension[1] || 0 }} x
          {{ truckDimension[2] || 0 }} mm</span
        >
      </div>
    </div>

    <div class="status-item">
      <div class="status-icon efficiency-icon">
        <mat-icon>data_usage</mat-icon>
      </div>
      <div class="status-info">
        <span class="status-label">Doluluk OranÄ±</span>
        <span class="status-value" [class]="getEfficiencyClass()"
          >{{ loadingStats.utilizationRate || 0 }}%</span
        >
      </div>
    </div>

    <div class="status-item">
      <div class="status-icon cog-icon">
        <mat-icon>balance</mat-icon>
      </div>
      <div class="status-info">
        <span class="status-label">COG Skoru</span>
        <span class="status-value" [class]="getCogScoreClass()"
          >{{ loadingStats.cogScore || 0 }}/100</span
        >
      </div>
    </div>
  </div>

  <!-- Progress Bar (only visible during loading) -->
  <div class="progress-container" *ngIf="isLoading">
    <div class="progress-header">
      <span class="progress-label">Optimizasyon Ä°lerliyor...</span>
      <span class="progress-percentage"
        >{{ optimizationProgress | number : "1.0-0" }}%</span
      >
    </div>
    <div class="progress-bar">
      <div class="progress-fill" [style.width.%]="optimizationProgress"></div>
    </div>
    <div class="progress-info">
      <span *ngIf="optimizationProgress < 30"
        >ğŸ“Š Algoritma hazÄ±rlanÄ±yor...</span
      >
      <span *ngIf="optimizationProgress >= 30 && optimizationProgress < 70"
        >ğŸ”„ Paketler yerleÅŸtiriliyor...</span
      >
      <span *ngIf="optimizationProgress >= 70 && optimizationProgress < 90"
        >ğŸ“‹ Raporlar oluÅŸturuluyor...</span
      >
      <span *ngIf="optimizationProgress >= 90">âœ… TamamlanÄ±yor...</span>
    </div>
  </div>

  <div class="controls-container">
    <div class="action-buttons">
      <button
        mat-raised-button
        class="calculate-button"
        [disabled]="isLoading"
        (click)="calculateBinpacking()"
      >
        <mat-icon>{{ isLoading ? "hourglass_empty" : "play_arrow" }}</mat-icon>
        <span>{{
          isLoading ? "HesaplanÄ±yor..." : "Optimizasyonu BaÅŸlat"
        }}</span>
      </button>

      <button
        mat-raised-button
        class="export-button"
        [disabled]="!hasResults || isLoading"
        (click)="openInNewTab()"
      >
        <div class="new-tab-icon">
          <div class="new-tab-square"></div>
          <div class="new-tab-arrow"></div>
        </div>
        <span>3D GÃ¶rÃ¼nÃ¼mÃ¼ AÃ§</span>
      </button>
    </div>

    <div class="view-controls">
      <button
        mat-button
        class="view-button"
        [class.active]="showVisualization && hasResults"
      >
        <mat-icon>view_in_ar</mat-icon>
        <span>3D</span>
      </button>
      <button mat-button class="view-button" [disabled]="!hasResults">
        <mat-icon>view_list</mat-icon>
        <span>Liste</span>
      </button>
      <button mat-button class="view-button" [disabled]="!hasResults">
        <mat-icon>grid_on</mat-icon>
        <span>Tablo</span>
      </button>
    </div>
  </div>

  <!-- Enhanced Visualization Container -->
  <div class="visualization-container">
    <!-- Loading Overlay -->
    <div *ngIf="isLoading" class="loading-overlay">
      <app-loading></app-loading>
      <p class="loading-text">
        {{
          optimizationProgress < 80
            ? "Optimizasyon hesaplanÄ±yor..."
            : "Raporlar hazÄ±rlanÄ±yor..."
        }}
      </p>
    </div>

    <!-- Empty State Overlay -->
    <div class="visualization-overlay" *ngIf="!hasResults && !isLoading">
      <div class="overlay-content">
        <mat-icon class="overlay-icon">local_shipping</mat-icon>
        <h3>Optimizasyon Bekleniyor</h3>
        <p>
          TÄ±r yÃ¼kleme optimizasyonunu baÅŸlatmak iÃ§in yukarÄ±daki "Optimizasyonu
          BaÅŸlat" butonuna tÄ±klayÄ±n.
        </p>
        <div
          class="quick-stats"
          *ngIf="truckDimension && truckDimension.length > 0"
        >
          <div class="quick-stat">
            <span class="stat-icon">ğŸ“</span>
            <span
              >TÄ±r Hacmi:
              {{
                (truckDimension[0] * truckDimension[1] * truckDimension[2]) /
                  1000000 | number : "1.0-1"
              }}
              mÂ³</span
            >
          </div>
        </div>
      </div>
    </div>

    <!-- 3D Visualization Component -->
    <app-plotly
      #plotlyComponent
      *ngIf="showVisualization && hasResults && !isLoading"
      [piecesData]="piecesData"
      [truckDimension]="truckDimension"
      [showHelp]="true"
      (packageSelected)="onPackageSelected($event)"
      (viewChanged)="onViewChanged($event)"
    >
    </app-plotly>

    <!-- Results Summary (visible after calculation) -->
    <div class="results-summary" *ngIf="hasResults && !isLoading">
      <div class="summary-cards">
        <div class="summary-card success">
          <div class="card-header">
            <mat-icon>check_circle</mat-icon>
            <h4>YÃ¼kleme BaÅŸarÄ±lÄ±</h4>
          </div>
          <div class="card-content">
            <div class="big-number">{{ loadingStats.packagesLoaded }}</div>
            <div class="card-label">Paket YÃ¼klendi</div>
            <div class="card-detail">
              {{ loadingStats.totalPackages }} paketten
              {{ loadingStats.packagesLoaded }} tanesi yÃ¼klendi
            </div>
          </div>
        </div>

        <div class="summary-card info">
          <div class="card-header">
            <mat-icon>donut_large</mat-icon>
            <h4>Hacim VerimliliÄŸi</h4>
          </div>
          <div class="card-content">
            <div class="big-number">%{{ loadingStats.utilizationRate }}</div>
            <div class="card-label">Doluluk OranÄ±</div>
            <div class="card-detail">
              {{ loadingStats.totalWeight | number : "1.0-0" }} kg toplam
              aÄŸÄ±rlÄ±k
            </div>
          </div>
        </div>

        <div class="summary-card" [ngClass]="getCogScoreClass()">
          <div class="card-header">
            <mat-icon>balance</mat-icon>
            <h4>AÄŸÄ±rlÄ±k Merkezi</h4>
          </div>
          <div class="card-content">
            <div class="big-number">{{ loadingStats.cogScore }}/100</div>
            <div class="card-label">COG Skoru</div>
            <div class="card-detail">
              <span *ngIf="loadingStats.cogScore >= 80" class="status-excellent"
                >MÃ¼kemmel denge</span
              >
              <span
                *ngIf="
                  loadingStats.cogScore >= 60 && loadingStats.cogScore < 80
                "
                class="status-good"
                >Ä°yi denge</span
              >
              <span
                *ngIf="
                  loadingStats.cogScore >= 40 && loadingStats.cogScore < 60
                "
                class="status-warning"
                >Orta denge</span
              >
              <span *ngIf="loadingStats.cogScore < 40" class="status-poor"
                >Dikkat gerekli</span
              >
            </div>
          </div>
        </div>

        <!-- Algorithm Performance Card (if data available) -->
        <div
          class="summary-card secondary"
          *ngIf="algorithmStats.executionTime > 0"
        >
          <div class="card-header">
            <mat-icon>speed</mat-icon>
            <h4>Algoritma PerformansÄ±</h4>
          </div>
          <div class="card-content">
            <div class="performance-stats">
              <div class="perf-item">
                <span class="perf-label">SÃ¼re:</span>
                <span class="perf-value"
                  >{{ algorithmStats.executionTime | number : "1.1-1" }}s</span
                >
              </div>
              <div class="perf-item">
                <span class="perf-label">Nesil:</span>
                <span class="perf-value">{{ algorithmStats.generations }}</span>
              </div>
              <div class="perf-item">
                <span class="perf-label">Fitness:</span>
                <span class="perf-value"
                  >{{ algorithmStats.bestFitness | number : "1.1-1" }}%</span
                >
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Enhanced Reports Section -->
  <div class="report-files-container" *ngIf="hasResults">
    <div class="report-files-header">
      <mat-icon>description</mat-icon>
      <span>Sevkiyat RaporlarÄ± ve Dosyalar</span>
      <span class="file-count" *ngIf="reportFiles && reportFiles.length > 0"
        >({{ reportFiles.length }})</span
      >
    </div>
    <div class="report-files-list">
      <div
        class="report-file-item"
        *ngFor="let file of reportFiles; trackBy: trackByFileId"
      >
        <div class="file-icon">
          <mat-icon [ngClass]="'file-type-' + getFileIcon(file.type)">{{
            getFileIcon(file.type)
          }}</mat-icon>
        </div>
        <div class="file-info">
          <a [href]="file.file" target="_blank" class="file-link">
            <span class="file-name">{{ file.name }}</span>
            <span class="file-size" *ngIf="file.size">{{
              formatFileSize(file.size)
            }}</span>
            <mat-icon class="download-icon">open_in_new</mat-icon>
          </a>
        </div>
      </div>
      <div class="empty-files" *ngIf="!reportFiles || reportFiles.length === 0">
        <mat-icon>info</mat-icon>
        <span
          >HenÃ¼z rapor dosyasÄ± oluÅŸturulmadÄ±. Optimizasyon tamamlandÄ±ktan sonra
          raporlar burada gÃ¶rÃ¼necek.</span
        >
      </div>
    </div>
  </div>

  <!-- Enhanced Legend -->
  <div class="legend-container" *ngIf="hasResults">
    <div class="legend-title">
      <mat-icon>info</mat-icon>
      <span>GÃ¶rselleÅŸtirme Rehberi</span>
    </div>
    <div class="legend-items">
      <div class="legend-item">
        <div class="legend-color package-color"></div>
        <span class="legend-text">Paletler (Renkli Kutular)</span>
        <span class="legend-detail">Her renk farklÄ± paketi temsil eder</span>
      </div>
      <div class="legend-item">
        <div class="legend-color truck-color"></div>
        <span class="legend-text">TIR Ä°Ã§ Hacmi</span>
        <span class="legend-detail">Gri Ã§izgiler tÄ±r sÄ±nÄ±rlarÄ±nÄ± gÃ¶sterir</span>
      </div>
      <div class="legend-item">
        <div class="legend-color empty-color"></div>
        <span class="legend-text">BoÅŸ Alan</span>
        <span class="legend-detail">KullanÄ±lmayan hacim</span>
      </div>
    </div>
    <div class="interaction-help">
      <h4>EtkileÅŸim Kontrolleri:</h4>
      <div class="help-items">
        <span class="help-item"
          >ğŸ–±ï¸ <strong>Sol TÄ±k + SÃ¼rÃ¼kle:</strong> DÃ¶ndÃ¼r</span
        >
        <span class="help-item"
          >ğŸ”„ <strong>Tekerlek:</strong> YakÄ±nlaÅŸtÄ±r/UzaklaÅŸtÄ±r</span
        >
        <span class="help-item"
          >ğŸ–±ï¸ <strong>SaÄŸ TÄ±k + SÃ¼rÃ¼kle:</strong> KaydÄ±r</span
        >
      </div>
    </div>
  </div>

  <!-- Navigation Controls -->
  <div class="navigation-controls">
    <button mat-raised-button matStepperPrevious class="previous-button">
      <mat-icon>arrow_back</mat-icon>
      <span>SipariÅŸ DetaylarÄ±na DÃ¶n</span>
    </button>

    <div class="finish-actions">
      <button
        mat-stroked-button
        class="save-button"
        [disabled]="!hasResults"
        (click)="saveResults()"
      >
        <mat-icon>save</mat-icon>
        <span>SonuÃ§larÄ± Kaydet</span>
      </button>

      <button
        mat-raised-button
        class="finish-button"
        [disabled]="!hasResults"
        (click)="completeShipment()">
        <mat-icon>check</mat-icon>
        <span>SevkiyatÄ± Tamamla</span>
      </button>
    </div>
  </div>
</div>
